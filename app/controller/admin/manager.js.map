{
    "version": 3,
    "sources": [
        "../../../src/controller/admin/manager.js"
    ],
    "names": [
        "Base",
        "require",
        "svgCaptcha",
        "module",
        "exports",
        "indexAction",
        "filePath",
        "think",
        "ROOT_PATH",
        "console",
        "log",
        "controller",
        "userInfo",
        "session",
        "isEmpty",
        "redirect",
        "display",
        "getCaptchaAction",
        "captcha",
        "create",
        "inverse",
        "fontSize",
        "noise",
        "width",
        "height",
        "text",
        "toLowerCase",
        "ctx",
        "res",
        "setHeader",
        "write",
        "String",
        "data",
        "end",
        "loginCheckAction",
        "isPost",
        "fail",
        "userAccount",
        "post",
        "userPassword",
        "captCha",
        "captSession",
        "isAdmin",
        "model",
        "isAdminManager",
        "success",
        "name",
        "operationAction",
        "isLogined",
        "admin_db",
        "where",
        "find",
        "JSON",
        "stringify",
        "icon_url",
        "assign",
        "loginoutAction"
    ],
    "mappings": "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",
    "file": "../../../src/controller/admin/manager.js",
    "sourcesContent": [
        "const Base = require('../base');\nconst svgCaptcha = require('svg-captcha');\nmodule.exports = class extends Base {\n  /**\n   * 管理员登录页面\n   * http://127.0.0.1:8360/admin/manager/\n   */\n  async indexAction() {\n    var filePath = `${think.ROOT_PATH}/view/admin/admin_login.html`\n    console.log('this.url =  ' + this.controller);\n    var userInfo = await this.session('userInfo');\n    console.log('indexAction userInfo is = ' + !think.isEmpty(userInfo))\n    if (!think.isEmpty(userInfo)) {\n      return this.redirect('/admin/manager/operation');\n    }\n    return this.display(filePath);\n  }\n\n\n   /**\n   * 获取验证码\n   * http://127.0.0.1:8360/admin/manager/getCaptcha\n   */\n\n  async  getCaptchaAction() {\n    var captcha = svgCaptcha.create({\n      // 翻转颜色 \n      inverse: false,\n      // 字体大小 \n      fontSize: 36,\n      // 噪声线条数 \n      noise: 2,\n      // 宽度 \n      width: 80,\n      // 高度 \n      height: 30,\n    });\n\n    await this.session('capt_cha', captcha.text.toLowerCase());\n    this.ctx.res.setHeader('Content-Type', 'image/svg+xml');\n    this.ctx.res.write(String(captcha.data));\n    this.ctx.res.end();\n\n  }\n  /**\n   * 是否登录成功\n   */\n  async loginCheckAction() {\n    if (!this.isPost) {\n      return this.fail(1000, 'connect error'); //指定错误号和错误信息\n    }\n\n    var userAccount = this.post('userAccount');\n    var userPassword = this.post('passWord');\n    var captCha = this.post('captCha');\n\n    var captSession = await this.session('capt_cha');\n    console.log(userAccount + ' : ' + userPassword + ' : captSession ' + captSession);\n\n    if(captSession.toLowerCase()!=captCha.toLowerCase()){\n      await this.session(); //delete session\n      return this.fail(1001, 'connect error'); //指定错误号和错误信息\n    }\n    var isAdmin = await this.model('think_admin').isAdminManager(userAccount, userPassword);\n    console.log(userAccount + ' : ' + userPassword + ' : reuslt in loginCheck is  = ' + !think.isEmpty(isAdmin));\n    if (!think.isEmpty(isAdmin)) {\n      await this.session('userInfo', userAccount);\n      return this.success({\n        name: 'ok'\n      });\n\n    } else {\n      await this.session(); //delete session\n      return this.fail(1000, 'connect error'); //指定错误号和错误信息\n    }\n  }\n\n  /**\n   * 操作页面\n   * http://127.0.0.1:8360/admin/manager/operation\n   */\n  async operationAction() {\n    var isLogined = await this.isLogined();\n    if (!isLogined) {\n      return this.redirect('/admin/manager');\n    }\n    var admin_db = await this.model('think_admin').where().find();\n    console.log('operationAction admin_db ====> ' + JSON.stringify(admin_db));\n    console.log('operationAction icon_url ====> ' + admin_db.icon_url);\n    this.assign('icon_url',admin_db.icon_url);\n    var filePath = `${think.ROOT_PATH}/view/admin/admin_operation.html`;\n    return this.display(filePath);\n  }\n\n  /**\n   * 退出登录\n   * http://127.0.0.1:8360/admin/manager/loginout\n   */\n  async loginoutAction() {\n    await this.session(null);\n    var userInfo = await this.session('userInfo');\n    console.log('loginout userInfo =  ' + userInfo);\n    const data = await this.session('userInfo');\n    console.log('loginout delete session is = ' + think.isEmpty(userInfo) + 'data = ' + data);\n    return this.redirect('/admin/manager');\n  }\n\n\n\n  /******************************工具方法************************************************************** */\n  /**\n   * 判断是否已经登录\n   */\n  async isLogined() {\n    var userInfo = await this.session('userInfo');\n    return !think.isEmpty(userInfo);\n  }\n\n\n\n}"
    ]
}